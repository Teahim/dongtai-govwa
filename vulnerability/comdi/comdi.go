package comdi

import (
	"net/http"
	"os/exec"

	"github.com/julienschmidt/httprouter"

	"github.com/govwa/util"
	"github.com/govwa/util/middleware"
)

type ComdI struct {
	Comd string
}

func New() ComdI {
	return ComdI{}
}
func (self ComdI) SetRouter(r *httprouter.Router) {
	mw := middleware.New()
	r.GET("/cmdi", mw.LoggingMiddleware(mw.AuthCheck(comdiHandler)))
}

func comdiHandler(w http.ResponseWriter, r *http.Request, _ httprouter.Params) {
	values := r.URL.Query()
	comd := values["cmd"][0]
	cmd := exec.Command(comd)
	cmd.Run()
	data := make(map[string]interface{}) //data to send to client
	data["cmd"] = comd
	util.SafeRender(w, r, "template.cmdi", data)
}
